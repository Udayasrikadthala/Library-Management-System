{% if session['role'] == 'librarian' %}
   {% include 'lhead.html' %}
{% endif %}
{% if session['role'] == 'student' %}
   {% include 'shead.html' %}
{% endif %}
<div class="m-20">
    {% for borrowing in borrowings %}
        {% set book = get_book_by_book_id(borrowing[7]) %}
        {% set librarian = get_librarian_by_librarian_id(borrowing[6]) %}
        {% set student = get_student_by_student_id(borrowing[5]) %}
    <div class="card p-5 mt-10">
            <div class="row">
                <div class="col-3">
                    <div>
                        <div class="row">
                            <div class="col-5">
                                <img class="book_name book-image p-5 " src="../static/books/{{book[5]}}" alt="">
                            </div>
                            <div class="col-7 ">
                                <div class="h6">Book Details</div>
                                <div class="row">
                                    <div class="mid">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#4040bf" class="bi bi-book-fill" viewBox="0 0 16 16">
                                          <path d="M8 1.783C7.015.936 5.587.81 4.287.94c-1.514.153-3.042.672-3.994 1.105A.5.5 0 0 0 0 2.5v11a.5.5 0 0 0 .707.455c.882-.4 2.303-.881 3.68-1.02 1.409-.142 2.59.087 3.223.877a.5.5 0 0 0 .78 0c.633-.79 1.814-1.019 3.222-.877 1.378.139 2.8.62 3.681 1.02A.5.5 0 0 0 16 13.5v-11a.5.5 0 0 0-.293-.455c-.952-.433-2.48-.952-3.994-1.105C10.413.809 8.985.936 8 1.783"/>
                                        </svg>&nbsp;
                                    </div>
                                    <div>{{book[1]}}</div>
                                </div>
                                <div class="row">
                                    <div class="mid">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#4040bf" class="bi bi-pen-fill" viewBox="0 0 16 16">
                                          <path d="m13.498.795.149-.149a1.207 1.207 0 1 1 1.707 1.708l-.149.148a1.5 1.5 0 0 1-.059 2.059L4.854 14.854a.5.5 0 0 1-.233.131l-4 1a.5.5 0 0 1-.606-.606l1-4a.5.5 0 0 1 .131-.232l9.642-9.642a.5.5 0 0 0-.642.056L6.854 4.854a.5.5 0 1 1-.708-.708L9.44.854A1.5 1.5 0 0 1 11.5.796a1.5 1.5 0 0 1 1.998-.001"/>
                                        </svg>&nbsp;
                                    </div>
                                <div>{{book[2]}}</div>
                                </div>
                                <div class="row">
                                    <div class="mid">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#4040bf" class="bi bi-calendar-fill" viewBox="0 0 16 16">
                                               <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V5h16V4H0V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5"/>
                                        </svg>&nbsp;
                                    </div>
                                    <div>{{book[3]}}</div>
                                </div>
                                <div class="h6">
                                    {% if  borrowing[8]  != None %}
                                       {% set book_copy=get_book_copy_by_book_copy_id(borrowing[8]) %}
                                         <div class="row">
                                             <div class="mid">
                                                 <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#4040bf" class="bi bi-bookmarks-fill" viewBox="0 0 16 16">
                                                     <path d="M2 4a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v11.5a.5.5 0 0 1-.777.416L7 13.101l-4.223 2.815A.5.5 0 0 1 2 15.5z"/>
                                                     <path d="M4.268 1A2 2 0 0 1 6 0h6a2 2 0 0 1 2 2v11.5a.5.5 0 0 1-.777.416L13 13.768V2a1 1 0 0 0-1-1z"/>
                                                 </svg>
                                             </div>
                                             <div>{{book_copy[1]}}</div>
                                         </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-3">
                    <div>
                         <div class="row">
                            <div class="col-5"></div>
                            <div class="col-7">
                                <div class="h6">Librarian Details</div>
                                <div class="row">
                                    <div class="mid">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#4040bf" class="bi bi-person-circle" viewBox="0 0 16 16">
                                             <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0"/>
                                             <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1"/>
                                        </svg> &nbsp;
                                    </div>
                                    <div>{{librarian[1]}}</div>
                                </div>
                                <div class="row">
                                    <div class="mid">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#4040bf" class="bi bi-phone-fill" viewBox="0 0 16 16">
                                            <path d="M3 2a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2zm6 11a1 1 0 1 0-2 0 1 1 0 0 0 2 0"/>
                                        </svg>&nbsp;
                                    </div>
                                    <div>{{librarian[2]}}</div>
                                </div>
                                <div class="row">
                                    <div class="mid">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#4040bf" class="bi bi-envelope-fill" viewBox="0 0 16 16">
                                          <path d="M.05 3.555A2 2 0 0 1 2 2h12a2 2 0 0 1 1.95 1.555L8 8.414zM0 4.697v7.104l5.803-3.558zM6.761 8.83l-6.57 4.027A2 2 0 0 0 2 14h12a2 2 0 0 0 1.808-1.144l-6.57-4.027L8 9.586zm3.436-.586L16 11.801V4.697z"/>
                                        </svg>&nbsp;
                                    </div>
                                    <div>{{librarian[3]}}</div>
                                </div>
                                <div class="row">
                                    <div class="mid">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#4040bf" class="bi bi-geo-alt-fill" viewBox="0 0 16 16">
                                            <path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10m0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6"/>
                                        </svg>&nbsp;
                                    </div>
                                    <div>{{librarian[5]}}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-3">
                    <div>
                        <div class="row">
                            <div class="col-5"></div>
                            <div class="col-7">
                                <div class="h6">Student Details</div>
                                <div class="row">
                                    <div class="mid">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#4040bf" class="bi bi-person-circle" viewBox="0 0 16 16">
                                             <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0"/>
                                             <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1"/>
                                        </svg>&nbsp;
                                    </div>
                                    <div>{{student[1]}}</div>
                                </div>
                                <div class="row">
                                    <div class="mid">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#4040bf" class="bi bi-envelope-fill" viewBox="0 0 16 16">
                                          <path d="M.05 3.555A2 2 0 0 1 2 2h12a2 2 0 0 1 1.95 1.555L8 8.414zM0 4.697v7.104l5.803-3.558zM6.761 8.83l-6.57 4.027A2 2 0 0 0 2 14h12a2 2 0 0 0 1.808-1.144l-6.57-4.027L8 9.586zm3.436-.586L16 11.801V4.697z"/>
                                        </svg>&nbsp;
                                    </div>
                                    <div>{{student[2]}}</div>
                                </div>
                                <div class="row">
                                    <div class="mid">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#4040bf" class="bi bi-phone-fill" viewBox="0 0 16 16">
                                            <path d="M3 2a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2zm6 11a1 1 0 1 0-2 0 1 1 0 0 0 2 0"/>
                                        </svg>&nbsp;
                                    </div>
                                    <div>{{student[4]}}</div>
                                </div>
                                <div class="row">
                                    <div class="mid">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#4040bf" class="bi bi-geo-alt-fill" viewBox="0 0 16 16">
                                            <path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10m0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6"/>
                                        </svg>&nbsp;
                                    </div>
                                    <div>{{student[5]}}</div>
                                </div>
                                <div class="row">
                                    <div class="mid">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#4040bf" class="bi bi-gender-female" viewBox="0 0 16 16">
                                          <path fill-rule="evenodd" d="M8 1a4 4 0 1 0 0 8 4 4 0 0 0 0-8M3 5a5 5 0 1 1 5.5 4.975V12h2a.5.5 0 0 1 0 1h-2v2.5a.5.5 0 0 1-1 0V13h-2a.5.5 0 0 1 0-1h2V9.975A5 5 0 0 1 3 5"/>
                                        </svg>&nbsp;
                                    </div>
                                    <div>{{student[6]}}</div>
                                </div>
                                <div class="row">
                                    <div class="mid">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#4040bf    " class="bi bi-calendar-fill" viewBox="0 0 16 16">
                                               <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V5h16V4H0V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5"/>
                                        </svg>&nbsp;
                                    </div>
                                    <div>{{student[7]}}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-3">
                    <div>
                        <div class="row">
                            <div class="col-5" ></div>
                            <div class="col-7">
                                <div class="h6">Borrowing Details</div>
                                <div class="row">
                                    <div class="mid">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="green" class="bi bi-bookmark-fill" viewBox="0 0 16 16">
                                                 <path d="M2 2v13.5a.5.5 0 0 0 .74.439L8 13.069l5.26 2.87A.5.5 0 0 0 14 15.5V2a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2"/>
                                            </svg>
                                    </div>
                                    <div>{{borrowing[1]}}</div>
                                </div>
                                <div>Requested on {{borrowing[2].strftime('%d-%m-%Y %I:%M %p')}}</div>
                                <div>
                                    {% if borrowing[9] != None %}
                                       Assigned on: {{borrowing[9].strftime('%d-%m-%Y %I:%M %p')}}
                                    {% endif %}
                                </div>
                                <div>
                                    {% if borrowing[3] != None %}
                                       Return Date: {{borrowing[3].strftime('%d-%m-%Y %I:%M %p')}}
                                    {% endif %}
                                </div>
                                {% if borrowing[3]!=None %}
                                    <div>
                                        {% set fine = get_fine_by_return_date(borrowing[3]) %}
                                        {% if fine != 0 %}
                                            Fine: $ {{fine}}
                                        {% endif %}
                                    </div>
                                {% endif %}
                                 {% if session['role'] == 'student'%}
                                       {% if borrowing[1] == 'Book Requested'%}
                                            <div class="mt-5">
                                                <form action="set_status" method="post">
                                                  <input type="hidden" name="borrowing_id" value="{{borrowing[0]}}">
                                                  <input type="hidden" name="status" value="Book Request Cancelled">
                                                  <input type="submit" value="Cancel Request" class="btn btn-danger">
                                                </form>
                                            </div>
                                      {% endif %}
                                        {% if borrowing[1] == 'Book Assigned'%}
                                                <div class="m-10">
                                                    <form action="return_book" method="post">
                                                        <input type="hidden" name="borrowing_id" value="{{borrowing[0]}}">
                                                        <input type="hidden" name="status" value="Book Return Requested">
                                                        <input type="submit" value="Return Book" class="btn color-secondary">
                                                    </form>
                                                </div>
                                                 <div class="m-10">
                                                    <form action="renewal_book" method="post">
                                                        <input type="hidden" name="borrowing_id" value="{{borrowing[0]}}">
                                                        <input type="hidden" name="status" value="Book Renewed">
                                                        <input type="submit" value="renewal" class="btn color-secondary-hover">
                                                    </form>
                                                 </div>
                                        {% endif %}
                                        {% if borrowing[1] == 'Book Renewed'%}
                                                <div class="m-10">
                                                    <form action="return_book" method="post">
                                                        <input type="hidden" name="borrowing_id" value="{{borrowing[0]}}">
                                                        <input type="hidden" name="status" value="Book Return Requested">
                                                        <input type="submit" value="Return Book" class="btn color-secondary">
                                                    </form>
                                                </div>
                                        {% endif %}
                                 {% endif %}
                                {% if session['role'] == 'librarian'%}
                                    {% if borrowing[1] == 'Book Requested'%}
                                      <div class="mt-5">
                                          <form action="set_status" method="post">
                                              <input type="hidden" name="borrowing_id" value="{{borrowing[0]}}">
                                              <input type="hidden" name="status" value="Book Request Accepted">
                                              <input type="submit" value="Accept" class="btn  btn-success">
                                          </form>
                                      </div>
                                      <div class="mt-5">
                                          <form action="set_status" method="post">
                                              <input type="hidden" name="borrowing_id" value="{{borrowing[0]}}">
                                              <input type="hidden" name="status" value="Book Request Rejected">
                                              <input type="submit" value="Reject" class="btn btn-danger">
                                          </form>
                                      </div>
                                   {% endif %}
                                   {% if borrowing[1] == 'Book Request Accepted' %}
                                    <div class="mt-5">
                                         <form action="assign_book" method="post">
                                             <input type="hidden" name="borrowing_id" value="{{borrowing[0]}}">
                                             <input type="hidden" name="book_id" value="{{book[0]}}">
                                             <input type="submit" value="Assign" class="btn btn-danger">
                                         </form>
                                    </div>
                                   {% endif %}
                                    {% if borrowing[1] == 'Book Return Requested'%}
                                      <div class="mt-5">
                                          <form action="set_status" method="post">
                                              <input type="hidden" name="borrowing_id" value="{{borrowing[0]}}">
                                              <input type="hidden" name="status" value="Book Returned">
                                              <input type="submit" value="Collect Book" class="btn btn-success">
                                          </form>
                                      </div>
                                   {% endif %}
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% endfor %}
</div>



